var latUser=!1,lngUser=!1,mapStore=!1,mapDeal=!1;$(document).ready(function(){process.showDeals(),$('#show_stores').click(function(){process.showStores()}),$('#show_deals').click(function(){process.showDeals()}),$('#geoloc').change(function(){process.geoloc()}),$('.change_category').change(function(){process.changeCategory()})}),process={showStores:function(){$('#show_stores').addClass('btn-info'),$('#show_deals').removeClass('btn-info'),$('#deals-map').hide(),$('#store-map').show();var a=document.getElementById('store-map'),b=[],c={center:new google.maps.LatLng(!1==latUser?$('#store-map').data('latitude'):latUser,!1==lngUser?$('#store-map').data('longitude'):lngUser),zoom:!1==latUser?$('#deals-map').data('zoom'):13,scrollwheel:!1,panControl:!1,zoomControl:!0,scaleControl:!0,mapTypeControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};mapStore=new google.maps.Map(a,c);var d=[],e=[],f=0;categoriesAccepted=[],$('.change_category:checked').each(function(){categoriesAccepted.push(parseInt($(this).val()))}),$('.store-localization').each(function(l,m){if(-1<$.inArray(parseInt($(m).data('category')),categoriesAccepted)){var n=5,o=$(m).data('latitude'),p=$(m).data('longitude');if(''!=o&&o!=void 0){o=parseFloat(o.toFixed(n)),p=parseFloat(p.toFixed(n));for(var q=!1,r=0;r<e.length;r++)if(e[r].lat==o&&e[r].lng==p){q=!0;var s=r}q?(e[s].title='Plusieurs commerces \xE0 cet endroit',e[s].description+='<hr /><strong>'+$(m).data('title')+'</strong><br />'+$(m).data('address')+'<br /><a href="'+$(m).data('link')+'">Voir leur page</a>',e[s].label++):(e[f]={},e[f].lat=o,e[f].lng=p,e[f].title=$(m).data('title'),e[f].description='<a href="'+$(m).data('link')+'"><img src="'+$(m).data('image')+'" style="max-height: 150px; max-width: 150px;" /></a><br />',e[f].description+='<strong class="mb-5">'+$(m).data('title')+'</strong><br />'+$(m).data('address')+'<br /><a href="'+$(m).data('link')+'" class="btn btn-xs mt-5"><i class="fa fa-eye"></i> Voir sa boutique</a>',e[f].label=1,f++)}}}),marker=[],$.each(e,function(l,m){marker[l]=new google.maps.Marker({position:{lat:m.lat,lng:m.lng},map:mapStore,title:m.title,icon:{url:'https://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%7CEE639E',labelOrigin:new google.maps.Point(11,11)},label:{text:m.label.toString(),color:'white',fontSize:'11px',fontWeight:'bold'}}),b.push(marker[l]),marker[l].addListener('mouseover',function(){'undefined'!=typeof infowindow&&infowindow.close(),infowindow=new google.maps.InfoWindow({content:m.description,maxWidth:300}),infowindow.open(mapStore,marker[l])}),google.maps.event.addListener(mapStore,'click',function(){'undefined'!=typeof infowindow&&infowindow.close()}),d.push(new google.maps.LatLng(m.lat,m.lng))});for(var g=new google.maps.LatLngBounds,f=0;f<d.length;f++)g.extend(d[f]);new MarkerClusterer(mapStore,b,{maxZoom:15,imagePath:$('#base_url').val()+'assets/images/brands/boutique',styles:[{textColor:'#FFFFFF',url:$('#base_url').val()+'assets/images/brands/store.png',width:55,height:55,fontWeight:'bold',textSize:14}]})},showDeals:function(){$('#show_stores').removeClass('btn-info'),$('#show_deals').addClass('btn-info'),$('#store-map').hide(),$('#deals-map').show();var a=document.getElementById('deals-map'),b=[],c={center:new google.maps.LatLng(!1==latUser?$('#deals-map').data('latitude'):latUser,!1==lngUser?$('#deals-map').data('longitude'):lngUser),zoom:!1==latUser?$('#deals-map').data('zoom'):13,scrollwheel:!1,panControl:!1,zoomControl:!0,scaleControl:!0,mapTypeControl:!1,streetViewControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};mapDeal=new google.maps.Map(a,c);var d=[],e=[],f=0;categoriesAccepted=[],$('.change_category:checked').each(function(){categoriesAccepted.push(parseInt($(this).val()))}),$('.deals-localization').each(function(l,m){if(-1<$.inArray(parseInt($(m).data('category')),categoriesAccepted)){var n=5,o=$(m).data('latitude'),p=$(m).data('longitude');if(''!=$(m).data('latitude')){o=parseFloat(o.toFixed(n)),p=parseFloat(p.toFixed(n));for(var q=!1,r=0;r<e.length;r++)if(e[r].lat==o&&e[r].lng==p){q=!0;var s=r}q?(e[s].title='Plusieurs bons plans \xE0 cet endroit',e[s].description+='<hr /><strong>'+$(m).data('title')+'</strong><br />'+$(m).data('company')+'<br /><a href="'+$(m).data('link')+'"><img src="'+$(m).data('image')+'" style="max-height: 150px; max-width: 150px;" /></a><br /><a href="'+$(m).data('link')+'">Voir le bon plan</a>',e[s].label++):(e[f]={},e[f].lat=o,e[f].lng=p,e[f].title=$(m).data('title'),e[f].description='<a href="'+$(m).data('link-company')+'" class="btn btn-xs mt-5"><i class="fa fa-eye"></i> Voir la boutique</a><br /><br /><strong class="mb-5">'+$(m).data('title')+'</strong><br />'+$(m).data('company')+'<br /><a href="'+$(m).data('link')+'"><img  style="max-height: 150px; max-width: 150px;" src="'+$(m).data('image')+'" /></a>',e[f].label=1,f++)}}}),marker=[],$.each(e,function(l,m){marker[l]=new google.maps.Marker({position:{lat:m.lat,lng:m.lng},map:mapDeal,title:m.title,icon:{url:'https://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%7CEE639E',labelOrigin:new google.maps.Point(11,11)},label:{text:m.label.toString(),color:'white',fontSize:'11px',fontWeight:'bold'}}),b.push(marker[l]),marker[l].addListener('mouseover',function(){'undefined'!=typeof infowindow&&infowindow.close(),infowindow=new google.maps.InfoWindow({content:m.description,maxWidth:300}),infowindow.open(mapDeal,marker[l])}),marker[l].addListener('click',function(){'undefined'!=typeof infowindow&&infowindow.close(),infowindow=new google.maps.InfoWindow({content:m.description,maxWidth:300}),infowindow.open(mapDeal,marker[l])}),google.maps.event.addListener(mapDeal,'click',function(){'undefined'!=typeof infowindow&&infowindow.close()}),d.push(new google.maps.LatLng(m.lat,m.lng))});for(var g=new google.maps.LatLngBounds,f=0;f<d.length;f++)g.extend(d[f]);new MarkerClusterer(mapDeal,b,{maxZoom:15,imagePath:$('#base_url').val()+'assets/images/brands/cluster',styles:[{textColor:'#FFFFFF',url:$('#base_url').val()+'assets/images/brands/cluster.png',width:55,height:55,fontWeight:'bold',textSize:14}]})},geoloc:function(){$('#geoloc').is(':checked')?(('undefined'==typeof localStorage.authorizedGeoLocation||'0'==localStorage.authorizedGeoLocation)&&$('#acceptGeoloc').modal('show'),'undefined'!=typeof localStorage.authorizedGeoLocation&&'1'==localStorage.authorizedGeoLocation&&$('#wait').modal('show'),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){$('#acceptGeoloc').modal('hide'),$('#wait').modal('hide'),localStorage.authorizedGeoLocation=1,latUser=a.coords.latitude,lngUser=a.coords.longitude,!1!=mapDeal&&(mapDeal.setCenter(new google.maps.LatLng(latUser,lngUser)),mapDeal.setZoom(13)),!1!=mapStore&&(mapStore.setCenter(new google.maps.LatLng(latUser,lngUser)),mapStore.setZoom(13))},function(){localStorage.authorizedGeoLocation=0,$('#acceptGeoloc').modal('hide')}):(localStorage.authorizedGeoLocation=0,$('#acceptGeoloc').modal('hide'),alert('Malheureusement votre navigateur Internet est trop vieux, impossible d\'utiliser cette fonctionnalit\xE9. :('))):(mapStore.setCenter(new google.maps.LatLng($('#store-map').data('latitude'),$('#store-map').data('longitude'))),mapStore.setZoom($('#store-map').data('zoom')),mapDeal.setCenter(new google.maps.LatLng($('#deals-map').data('latitude'),$('#deals-map').data('longitude'))),mapDeal.setZoom($('#deals-map').data('zoom')),latUser=!1,lngUser=!1)},changeCategory:function(){console.log($('#store-map').is(':visible')),$('#store-map').is(':visible')?process.showStores():process.showDeals()}};