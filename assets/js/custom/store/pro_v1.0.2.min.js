$(document).ready(function(){ismobile&&process.changeLinks(),process.getLogos(),process.dropzone(),process.autocomplete(),$(".social_choose").click(function(){process.boostSocial($(this))}),$("#boost_slider, #boost_top").change(function(){process.calculCommission()}),$("#boost_target").change(function(){process.facebookTarget()}),$("ul.nav a").click("shown.bs.tab",function(e){"#stats"==$(e.target).attr("href")&&(process.statsViews(),process.statsSales())}),void 0!=$("#legalConfirm")&&process.legalConfirm(),$("#changePass").click(function(e){e.preventDefault(),$(".changePass").slideDown(),$("#changePass").hide()})}),process={legalConfirm:function(){$("#legalConfirm").modal({backdrop:"static",keyboard:!1}),$("#legalConfirm").modal("show")},changeLinks:function(){$("a[aria-controls]").each(function(){void 0!=$(this).attr("href_mobile")&&($(this).attr("href",$(this).attr("href_mobile")),$(this).removeAttr("data-toggle").removeAttr("aria-controls").removeAttr("aria-expanded").removeAttr("role").removeAttr("href_mobile"))})},autocomplete:function(){var e=document.getElementById("address");autocomplete=new google.maps.places.SearchBox(e),autocomplete.addListener("places_changed",function(){var e=autocomplete.getPlaces();if(myAdress=e[0].address_components,void 0!=e[0]&&void 0!=e[0].types&&void 0!=e[0].types[0]&&"street_address"==e[0].types[0])for(key in myAdress)void 0!=myAdress[key].types&&("postal_code"==myAdress[key].types[0]&&$("#zipcode").val(myAdress[key].long_name),"street_number"==myAdress[key].types[0]&&$("#address").val(myAdress[key].long_name),"route"==myAdress[key].types[0]&&$("#address").val($("#address").val()+" "+myAdress[key].long_name));lat=e[0].geometry.location.lat(),lng=e[0].geometry.location.lng(),null!=lat&&null!=lng&&($("#latitude").val(lat),$("#longitude").val(lng))})},boostSocial:function(e){$(".social_choose").removeClass("btn-info"),e.addClass("btn-info"),$("#social_amount").val(e.attr("num"))},calculCommission:function(){priceTotal=0,priceTotal+=30*parseInt($("#boost_slider").val()),priceTotal+=10*parseInt($("#boost_top").val()),$("#boost_zotdeal_calcul h4:eq(2)").html(priceToShow(priceTotal)),priceTotal>0?$("#valid_boost_zotdeal").show():$("#valid_boost_zotdeal").hide()},statsViews:function(){void 0!=$(".stats_view_data").data("count")&&(stats=[],$(".stats_view_data").each(function(){stats.push({day:$(this).data("day"),value:$(this).data("count")})}),$("#stats_views").css("width",parseInt($("#stats").width())-30),myStatsViews=new Morris.Line({parseTime:!1,element:"stats_views",data:stats,xkey:"day",ykeys:["value"],labels:["Nombre de visiteurs"]}),myStatsViews.redraw(),$("svg").css("width",parseInt($("#stats").width())-30))},statsSales:function(){void 0!=$(".stats_sales_data").data("count")&&(statsSales=[],$(".stats_sales_data").each(function(){statsSales.push({day:$(this).data("day"),value:$(this).data("count")})}),$("#stats_sales").css("width",parseInt($("#stats").width())-30),myStatsSales=new Morris.Line({element:"stats_sales",data:statsSales,xkey:"day",ykeys:["value"],labels:["Nombre de ventes"]}),myStatsSales.redraw(),$("svg").css("width",parseInt($("#stats").width())-30))},facebookTarget:function(){switch($("#boost_target").val()){case"0":$(".social_choose:eq(0) span").html("17 000"),$(".social_choose:eq(1) span").html("40 000"),$(".social_choose:eq(2) span").html("100 000");break;case"Nord":$(".social_choose:eq(0) span").html("17 000"),$(".social_choose:eq(1) span").html("37 000"),$(".social_choose:eq(2) span").html("75 000");break;case"Sud":$(".social_choose:eq(0) span").html("13 000"),$(".social_choose:eq(1) span").html("28 000"),$(".social_choose:eq(2) span").html("47 000");break;case"Est":$(".social_choose:eq(0) span").html("12 000"),$(".social_choose:eq(1) span").html("26 000"),$(".social_choose:eq(2) span").html("36 000");break;case"Ouest":$(".social_choose:eq(0) span").html("13 000"),$(".social_choose:eq(1) span").html("28 000"),$(".social_choose:eq(2) span").html("49 000")}},getLogos:function(e){$(".logos").html(""),$.ajax({url:$("#base_url").val()+"ajax/loadBrandLogos",dataType:"json"}).complete(function(e){if(void 0!=e.responseJSON&&"false"!=e.responseJSON){for(key in e.responseJSON)$(".logos").append('<div class="col-md-3 mb-5 text-center" '+(1==ismobile?"":'style="height: 125px;"')+'><a href="#" class="logoToChoose" image="shops/'+e.responseJSON[key]+'"><img src="'+$("#base_url").val()+"assets/images/brands/shops/"+e.responseJSON[key]+'" '+(1==ismobile?"":'style="max-height: 125px;"')+" /></div>");$(".logos").append('<div class="clear clearfix">&nbsp;</div>'),process.chooseLogo()}}).error(function(){})},chooseLogo:function(){$(".logoToChoose").unbind("click"),$(".logoToChoose").click(function(e){e.preventDefault(),_this=$(this),$.ajax({url:$("#base_url").val()+"ajax/updateLogo",data:{logo:$(this).attr("image")},method:"post",dataType:"json"}).complete(function(e){void 0!=e.responseJSON&&1==e.responseJSON&&($("#logo_brand").attr("src",$("#base_url").val()+"assets/images/brands/"+_this.attr("image")),$("#chooseLogo").modal("hide"))}).error(function(){})})},dropzone:function(){Dropzone.autoDiscover=!1,$("#addMyPics").dropzone({url:$("#base_url").val()+"ajax/addPicsStore/",addRemoveLinks:!0,dictRemoveFile:"Supprimer",dictCancelUpload:"Annuler",dictInvalidFileType:"Fichier non autorisé",dictFileTooBig:"Cette photo est trop grande. Maximum autorisé : {{maxFilesize}}Mb",maxFilesize:10,maxFiles:4,acceptedFiles:"image/*",dictDefaultMessage:'<h3 class="text-center"><span class="font-lg"><i class="fa fa-photo"></i> .png .jpg .gif <span class="font-xs"></span></span><h3>&nbsp&nbsp<h4 class="display-inline"></h4>',dictResponseError:"Erreur durant l'envoi de vos photos",removedfile:function(e){$.ajax({url:$("#base_url").val()+"ajax/deletePicsStore/",data:{name:e.name},dataType:"json",method:"post"}).complete(function(s){void 0!=s.responseJSON&&"false"!=s.responseJSON&&$(e.previewElement).remove()}).error(function(){})}})}};