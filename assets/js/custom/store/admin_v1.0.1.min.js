$(document).ready(function(){admin.colorpicker(),admin.dropzone(),admin.loadCategories(),admin.getCovers(),admin.loadTinymce(),$("#cms_page").change(function(){page=$("#cms_page").val(),page=page.split("+"),admin.loadCmsContent(page[0],page[1])}),$(".companyDatas").click(function(){admin.loadCompanyDatas($(this).attr("company_id"))})}),admin={loadTinymce:function(){tinymce.init({selector:"#content_cms",menubar:!0,height:"680",language:"fr_FR",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern imagetools codesample toc"],toolbar1:"undo redo | insert | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",toolbar2:"print preview media | forecolor backcolor emoticons ",init_instance_callback:function(e){page=$("#cms_page option:eq(0)").val(),page=page.split("+"),admin.loadCmsContent(page[0],page[1])}})},loadCmsContent:function(e,o){$.ajax({url:$("#base_url").val()+"ajax/loadCmsContent/"+e+"/"+o,dataType:"json"}).complete(function(e){void 0!=e.responseJSON&&"false"!=e.responseJSON&&0!=e.responseJSON?tinyMCE.activeEditor.setContent(e.responseJSON):tinyMCE.activeEditor.setContent("<p>Aucun contenu</p>")}).error(function(){})},loadCategories:function(){$.ajax({url:$("#base_url").val()+"ajax/loadCategories",dataType:"json"}).complete(function(e){if(void 0!=e.responseJSON&&"false"!=e.responseJSON&&0!=e.responseJSON){var o=e.responseJSON;$("#categoriesList").treeview({color:"#F91653",showTags:!0,data:o})}else $("#categoriesList").html('<div class="alert alert-error">Impossible de charger les catégories.</div>')}).error(function(){$("#categoriesList").html('<div class="alert alert-error">Impossible de charger les catégories.</div>')})},getCovers:function(){$(".loadingCoversError").hide(),$(".covers").html(""),$.ajax({url:$("#base_url").val()+"ajax/loadImagesCategory",dataType:"json"}).complete(function(e){if(void 0!=e.responseJSON&&"false"!=e.responseJSON){for(key in e.responseJSON)$(".covers").append('<div class="col-md-3 mb-5 text-center" '+(1==ismobile?"":'style="height: 125px;"')+'><a href="#" class="coverToChoose" image="'+e.responseJSON[key]+'"><img src="'+$("#base_url").val()+"assets/images/"+e.responseJSON[key]+'" '+(1==ismobile?"":'style="max-height: 125px;"')+" /></div>");$(".covers").append('<div class="clear clearfix">&nbsp;</div>'),admin.chooseCover()}else $(".loadingCoversError").show()}).error(function(){$(".loadingCoversError").show()})},chooseCover:function(){$(".coverToChoose").unbind("click"),$(".coverToChoose").click(function(e){e.preventDefault(),$(".coverToChoose img").css("border",""),$("img",this).css("border","3px solid lightgreen"),$(".coverInput").val($(this).attr("image")),$("#chooseCover").modal("hide")})},dropzone:function(){Dropzone.autoDiscover=!1,$("#addPicsCategories").dropzone({url:$("#base_url").val()+"ajax/addPicsCategories/",addRemoveLinks:!0,dictRemoveFile:"Supprimer",dictCancelUpload:"Annuler",dictInvalidFileType:"Fichier non autorisé",dictFileTooBig:"Cette photo est trop grande. Maximum autorisé : {{maxFilesize}}Mb",maxFilesize:10,maxFiles:50,acceptedFiles:"image/*",dictDefaultMessage:'<h3 class="text-center"><span class="font-lg"><i class="fa fa-photo"></i> .png .jpg .gif <span class="font-xs"></span></span><h3>&nbsp&nbsp<h4 class="display-inline"></h4>',dictResponseError:"Erreur durant l'envoi de vos photos",complete:function(){admin.getCovers()},removedfile:function(e){$.ajax({url:$("#base_url").val()+"ajax/deletePicsCategories/",data:{name:e.name},dataType:"json",method:"post"}).complete(function(o){void 0!=o.responseJSON&&"false"!=o.responseJSON&&($(e.previewElement).remove(),admin.getCovers())}).error(function(){})},init:function(){var e=this;$.getJSON($("#base_url").val()+"ajax/loadAllMedias/",function(o){$.each(o,function(o,a){var t={name:a.name,size:a.size};e.options.addedfile.call(e,t),e.options.thumbnail.call(e,t,a.url)})})}})},colorpicker:function(){for(i=1;i<=4;i++)$("#color_"+i).ColorPicker({color:"#"+$("#color_"+i).val(),onShow:function(e){return $(e).fadeIn(500),!1},onHide:function(e){return $(e).fadeOut(500),!1},onSubmit:function(e,o,a,t){$(t).val(o),$(t).ColorPickerHide()}})},loadCompanyDatas:function(e){$("#store_company").html($("#store_company_"+e).val()),$("#store_name_dealer").html($("#store_name_dealer_"+e).val()),$("#store_address").html($("#store_address_"+e).val()),$("#store_zipcode").html($("#store_zipcode_"+e).val()),$("#store_city").html($("#store_city_"+e).val()),$("#store_phone").html($("#store_phone_"+e).val()),$("#store_email").html($("#store_email_"+e).val()),$("#store_informations").html($("#store_informations_"+e).val()),$("#store_bank_company").html($("#store_bank_company_"+e).val()),$("#store_bank_name").html($("#store_bank_name_"+e).val()),$("#store_bank_address").html($("#store_bank_address_"+e).val()),$("#store_bank_iban").html($("#store_bank_iban_"+e).val()),$("#store_bank_bic").html($("#store_bank_bic_"+e).val()),$("#store_paypal_email").html($("#store_paypal_email_"+e).val())}};